:root{
  /* Thema */
  --cb-primary:#3f51b5; --cb-primary-contrast:#fff;
  --cb-bg:#fff; --cb-text:#1b1f24; --cb-user:#e8f0ff; --cb-bot:#f2f3f5;
  --cb-shadow:0 10px 30px rgba(0,0,0,.15);
  --cb-radius:16px; --cb-font:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;

  /* Bubble */
  --cb-bubble-size:64px;
  --cb-bubble-gap:20px;

  /* Default window size */
  --cb-width:380px; --cb-height:560px;

  /* Min/max voor resizen */
  --cb-min-width:300px; --cb-min-height:360px;

  --cb-open-zoom: 1;
}

/* Floating bubble */
.cb-bubble{
  position:fixed; right:var(--cb-bubble-gap); bottom:var(--cb-bubble-gap);
  width:var(--cb-bubble-size); height:var(--cb-bubble-size);
  border-radius:50%; box-shadow:var(--cb-shadow);
  cursor:pointer; z-index:9999; border:0; padding:0;
  background:none; outline-offset:3px;
  display:grid; place-items:center;
  transition: transform .25s ease;
}
.cb-bubble:hover{
  transform: scale(1.12);
}
.cb-bubble.is-open:hover{
  transform: scale(1.18);
}

/* Icon-lagen */
.cb-icon{
  position:absolute;
  inset:-1px;
  width:calc(100% + 2px);
  height:calc(100% + 2px);
  border-radius:50%;
  object-fit:cover;
  object-position:center;
  transition:opacity .25s ease, transform .25s ease, filter .25s ease;
  will-change:opacity,transform;
  user-select:none; pointer-events:none;
}
.cb-icon-closed{ opacity:1; transform:scale(1); }
.cb-icon-open  { opacity:0; transform:scale(var(--cb-open-zoom)) rotate(-6deg); }
.cb-bubble.is-open .cb-icon-closed{ opacity:0; transform:scale(1.05) rotate(6deg); }
.cb-bubble.is-open .cb-icon-open  { opacity:1; transform:scale(var(--cb-open-zoom)) rotate(0); }

/* Chat window */
.cb-window{
  position: fixed;
  right: calc(var(--cb-bubble-gap) - 4px);
  bottom: calc(var(--cb-bubble-gap) + var(--cb-bubble-size) + 10px);

  width: var(--cb-width);
  height: var(--cb-height);
  min-width: var(--cb-min-width);
  min-height: var(--cb-min-height);
  max-width: min(90vw, 760px);
  max-height: min(85vh, 900px);

  background: var(--cb-bg);
  color: var(--cb-text);
  font-family: var(--cb-font);

  border-radius: 10px;
  box-shadow: var(--cb-shadow);

  /* üîí inhoud clippen zodat header-hoeken ook rond zijn */
  overflow: hidden;

  transform: translateY(20px) scale(.97);
  opacity: 0;
  pointer-events: none;
  transition:
    opacity .28s ease,
    transform .32s cubic-bezier(.16,.84,.44,1);
  z-index: 9999;
}

.cb-window.cb-open{
  display:grid;
  grid-template-rows:auto 1fr auto;

  opacity:1;
  transform: translateY(0) scale(1);
  pointer-events:auto;
}

/* Tijdens resizen */
.cb-window.cb-resizing, .cb-window.cb-resizing *{
  user-select:none !important;
  -webkit-user-select:none !important;
}

/* Header */
.cb-header{
  display:grid; grid-template-columns:auto 1fr auto; align-items:center; gap:12px;
  padding:14px 16px; background:var(--cb-primary); color:var(--cb-primary-contrast);
  cursor:default;
}
.cb-avatar{ width:40px;height:40px;border-radius:50%;overflow:hidden;background:rgba(255,255,255,.2);display:grid;place-items:center; }
.cb-avatar img{ width:100%;height:100%;object-fit:cover;display:block; }
.cb-title{ font-weight:600; letter-spacing:.2px; }
.cb-close{ opacity:.9; cursor:pointer; font-size:20px; line-height:1; }

/* Body */
.cb-body{
  padding:12px;
  overflow:auto;
  background:linear-gradient(#fff,#fff) padding-box;
  position:relative;
  user-select:text;
}

/* Watermark */
.cb-watermark{
  position:absolute; inset:0;
  z-index:0;
  pointer-events:none;
  display:grid; place-items:center;
  opacity:.08;
}
.cb-watermark img{ max-width:60%; max-height:60%; filter:grayscale(100%); }
.cb-watermark.tiled{
  background-repeat:repeat;
  background-position:0 0;
  background-size:220px auto;
}
.cb-watermark-text{
  position:absolute; right:12px; bottom:8px;
  font-size:12px; opacity:.35;
  pointer-events:none; color:#000;
  mix-blend-mode:multiply;
}

/* Chat bubbles */
.cb-msg{
  position:relative; z-index:1;
  max-width:82%;
  padding:10px 12px;
  border-radius:14px;
  margin:8px 0;
  line-height:1.5;
  word-wrap:break-word;
  white-space:normal;
  user-select:text;
  animation: cbMsgIn .22s ease;
}
@keyframes cbMsgIn{
  from{ opacity:0; transform:translateY(4px); }
  to  { opacity:1; transform:translateY(0); }
}
.cb-msg.bot  { background:var(--cb-bot); border-top-left-radius:4px; }
.cb-msg.user { background:var(--cb-user); border-top-right-radius:4px; margin-left:auto; }

/* Markdown etc */
.cb-msg p{ margin:0 0 .5em 0; }
.cb-msg h1,.cb-msg h2,.cb-msg h3{ margin:.2em 0 .3em; line-height:1.25; }
.cb-msg h1{ font-size:1.15rem; }
.cb-msg h2{ font-size:1.1rem; }
.cb-msg h3{ font-size:1.05rem; }
.cb-msg strong{ font-weight:700; }
.cb-msg em{ font-style:italic; }

.cb-msg ul, .cb-msg ol{
  padding-left:1.2em; margin:.3em 0 .6em;
}
.cb-msg li{ margin:.15em 0; }

.cb-msg code{
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-size:.9em; background:#f3f4f6; padding:.12em .35em; border-radius:6px;
  user-select:text;
}
.cb-msg pre{
  margin:.4em 0; background:#f6f7f9; border-radius:10px; padding:.6em .8em; overflow:auto;
}
.cb-msg pre code{ background:transparent; padding:0; }

.cb-msg a{
  color:var(--cb-primary);
  text-decoration:underline;
  word-break:break-word;
}
.cb-msg img.cb-img{
  max-width:100%;
  height:auto;
  display:block;
  border-radius:10px;
  margin:.35em 0 0;
  user-select:none;
}

/* Footer */
.cb-footer{
  display:grid; grid-template-columns:1fr auto;
  gap:8px; padding:10px; border-top:1px solid #ececec; background:#fafafa;
}
.cb-input{
  border:1px solid #e2e2e2; padding:10px 12px; border-radius:12px; outline:none; font:inherit; background:#fff;
  user-select:text;
}
.cb-send{ background:var(--cb-primary); color:var(--cb-primary-contrast); border:0; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600; }
.cb-send[disabled]{ opacity:.6; cursor:not-allowed; }

/* Typing */
.cb-typing{ display:inline-flex; gap:4px; align-items:center; margin-left:4px; }
.cb-dot{ width:6px; height:6px; border-radius:50%; background:#999; opacity:.5; animation:cbblink 1.2s infinite; }
.cb-dot:nth-child(2){ animation-delay:.2s; }
.cb-dot:nth-child(3){ animation-delay:.4s; }
@keyframes cbblink{ 0%,80%,100%{opacity:.2} 40%{opacity:.9} }

/* Resize handle (linksboven) */
.cb-resize{
  position:absolute; left:3px; top:3px;
  width:18px; height:18px;
  border-radius:4px;
  cursor:nw-resize;
  z-index:2;
  background:
    linear-gradient(315deg, hsla(0, 0%, 100%, 0.5) 0 49%, transparent 50%) no-repeat,
    linear-gradient(315deg, transparent 0 49%, rgba(255, 255, 255, 0.5) 50%) no-repeat;
  background-size:100% 100%, 70% 70%;
  background-position:center, left top;
  opacity:0.12;
  transition:opacity .15s ease;
}
.cb-resize:hover{ opacity:.6; }

@media (max-width:480px){
  .cb-window{ right:10px; left:10px; width:auto; height:70vh; }
  .cb-resize{ display:none; }
}

/* ----------------------------------------------------
   OPEN/CLOSE ANIMATION: smooth + bouncy ‚Äúdoor‚Äù effect
   - minder squish: X gaat naar ¬±55% i.p.v. 30%
   - bouncy easing met overshoot
---------------------------------------------------- */

/* Startstate voor openen: smal strookje rechtsonder, dichtgeklapt in Y */
.cb-window.cb-opening-start{
  transform-origin: right bottom;
  transform: translateY(8px) scaleX(0.2) scaleY(0);
  opacity: 0;
  transition: none;
}

/* Open fase 1: Y uitklappen (van onder naar boven), X blijft smal */
.cb-window.cb-opening-phase1{
  transform-origin: right bottom;
  transform: translateY(-4px) scaleX(0.2) scaleY(1.08);
  opacity: 0.98;
  transition:
    transform .32s cubic-bezier(.22, 1.4, .46, 1.02),
    opacity  .26s ease-out;
}

/* Open fase 2: X uitklappen naar volle breedte, Y normaliseert */
.cb-window.cb-opening-phase2{
  transform-origin: right center;
  transform: translateY(0) scaleX(1) scaleY(1);
  opacity: 1;
  transition:
    transform .30s cubic-bezier(.18, 1.1, .35, 1),
    opacity  .22s ease-out;
}

/* Close fase 1: X inklappen naar ¬±55% (nog wat window zichtbaar) */
.cb-window.cb-closing-phase1{
  transform-origin: right center;
  transform: translateY(-2px) scaleX(0.2) scaleY(1.03);
  opacity: 0.96;
  transition:
    transform .30s cubic-bezier(.18, 1.1, .35, 1),
    opacity  .22s ease-out;
}

/* Close fase 2: Y inklappen naar beneden, klein ‚Äúdropje‚Äù */
.cb-window.cb-closing-phase2{
  transform-origin: right bottom;
  transform: translateY(8px) scaleX(0.2) scaleY(0);
  opacity: 0;
  transition:
    transform .32s cubic-bezier(.22, 1.4, .46, 1.02),
    opacity  .24s ease-out;
}